/*! Generated by Clam: wechat 2016-04-11 17:51:41 */
!function(a,b){var c=function(){var a=this;Wlib.wx.getJSSign("",function(b){Wlib.wx.jsConfig(b,function(){Wlib.wx.hideMenu(),a.init()})})};c.prototype={init:function(){var a=this;a.addJuicerHandler(),a.cacheData(),a.cacheDom(),a.renderUI(),a.recacheDom(),a.bindEvent()},cacheData:function(){var a=this;a.data={},a.data.desTel=Wlib.getRequestParam("tel"),a.data.code=localStorage.getItem("code")},cacheDom:function(){var a=this;a.dom={wrapper:b("#page"),loading:b("#loading"),tpl:b("#tpl")}},renderUI:function(){var a=this;a.dom.wrapper.html(juicer(a.dom.tpl.html(),a.data)),a.dom.loading.hide()},recacheDom:function(){var a=this;a.dom.telLabel=b(".tel"),a.dom.codeInput=b("input"),a.dom.reSend=b(".input-wrap>.button"),a.dom.secondLable=b(".input-wrap span"),a.dom.confirm=b("#next"),a.dom.noCode=b("p.no-code")},addJuicerHandler:function(){var a=this;juicer.register("makeTel",function(){var b=a.data.desTel.split("");return b.slice(0,3).join("")+"-"+b.slice(3,7).join("")+"-"+b.slice(7,11).join("")})},bindEvent:function(){var c=this;FastClick.attach(document.body),c.makeCountDown(function(){c.dom.reSend.removeClass("disable"),c.dom.reSend.html("\u91cd\u65b0\u83b7\u53d6")}),c.dom.reSend.on("click",function(){var a=this,d=b(this).hasClass("disable");d||c.sendCode(function(){b(a).addClass("disable").html("<span>60</span>\u79d2\u540e\u91cd\u65b0\u83b7\u53d6"),c.makeCountDown(function(){c.dom.reSend.removeClass("disable"),c.dom.reSend.html("\u91cd\u65b0\u83b7\u53d6")})})}),c.dom.confirm.on("click",function(){c.bindTel(function(){localStorage.setItem("isbind","1");var b=localStorage.getItem("bindNextAction"),d=localStorage.getItem("bindNextObj")&&JSON.parse(localStorage.getItem("bindNextObj"));return"my"==b?void(a.location.href="../../pages/my/index.html"):void("auction"==b&&Wlib.SendRequest("default/api/bid",d,"POST",function(b){1==b.state?(Wlib.tips("\u51fa\u4ef7\u6210\u529f"),setTimeout(function(){a.location.href="../../pages/auction/index.html?id="+d.id},3e3)):(c.dom.loading.hide(),Wlib.tips(b.message))}))})})},sendCode:function(a){var b=this,c={phone:b.data.desTel,type:5,open_id:localStorage.getItem("openid")};Wlib.SendRequest("default/index/getCode",c,"GET",function(b){0==b.state?Wlib.tips(b.message):(localStorage.setItem("code",b.code),a&&a())})},bindTel:function(a){var b=this,c={uid:localStorage.getItem("uid"),token:localStorage.getItem("token"),phone:b.data.desTel,open_id:localStorage.getItem("openid"),code:b.dom.codeInput.val()};Wlib.SendRequest("wechat/wechat/bindphone",c,"GET",function(b){0==b.state?Wlib.tips(b.message):(localStorage.setItem("code",""),a&&a())})},makeCountDown:function(a){var c=this,d=59;c.dom.secondLable=c.dom.secondLable?c.dom.secondLable:b(".input-wrap span");var e=setInterval(function(){0==d?(a&&a(),clearInterval(e),e=null,c.dom.secondLable=null):c.dom.secondLable.text(d),d--},1e3)}};new c}(window,$);