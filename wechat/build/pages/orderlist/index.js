/*! Generated by Clam: wechat 2016-04-17 21:35:08 */
!function(a,b){var c=function(){this.init()},d=location.href.split("#")[0];c.prototype={init:function(){var a=this;Wlib.wx.getJS(d,function(){a.cacheDom(),a.cacheData(),a.addJuicerHandler(),a.fetchData()})},cacheDom:function(){var a=this;a.dom={wrapper:b("#page"),loading:b("#loading"),tpl:b("#tpl")}},cacheData:function(){var a=this;a.data={userId:localStorage.getItem("userId"),orderStatus:Wlib.getRequestParam("orderStatus")||"-1",orderType:Wlib.getRequestParam("orderType")||"-1",firstResult:0,maxResults:10,token:localStorage.getItem("token"),openid:localStorage.getItem("openid")}},renderUI:function(){var a=this;a.dom.wrapper.html(juicer(a.dom.tpl.html(),a.data)),a.dom.loading.hide()},recacheDom:function(){var a=this;a.dom.filter=b("#filter"),a.dom.overlay=b("#overlay"),a.dom.filterbox=b(".filterbox"),a.dom.bannerItems=b(".item")},fetchData:function(){var a=this,b={orderStatus:a.data.orderStatus,userid:a.data.userId,orderType:a.data.orderType,firstResult:a.data.firstResult||0,maxResults:a.data.maxResults||15};Wlib.SendRequestNew("treatOperate","findOrders",b,function(b){0==b.errorCode?(a.data.olist=b.value,a.renderUI(),a.recacheDom(),a.bindEvent(),b.value&&b.value.length==a.data.maxResults&&a.bindNext(!0),b.value&&0!=b.value.length||Wlib.tips("\u6ca1\u6709\u67e5\u8be2\u5230\u76f8\u5173\u8bb0\u5f55\u3002",null,!0)):Wlib.tips(b.message)})},bindNext:function(a){var c=this;Wlib._bindScrollTobottom(function(){c.data.firstResult=c.data.firstResult+c.data.maxResults;var a={orderStatus:c.data.orderStatus,userid:c.data.userId,orderType:c.data.orderType,firstResult:c.data.firstResult||0,maxResults:c.data.maxResults||10};Wlib.SendRequestNew("treatOperate","findOrders",a,function(a){var d={};d.olist=a.value||[];var e=juicer(b("#itemtpl").html(),d);b(".list-wrapper").append(e),b(".topayBtn").die("click"),on("click",function(){var a=b(this).attr("data-oid"),d=b(this).attr("data-price");c.payFor(a,d)}),a.value.length==c.data.maxResults&&c.bindNext(!0),a.value&&0!=a.value.length||Wlib.tips("\u6ca1\u6709\u67e5\u8be2\u5230\u76f8\u5173\u8bb0\u5f55\u3002")})},a)},addJuicerHandler:function(){var a=this;juicer.register("makeStatus",function(a){var b="\u672a\u4ed8\u6b3e";switch(a){case 1:b="\u672a\u4ed8\u6b3e";break;case 2:b="\u5f85\u5b8c\u6210";break;case 3:b="\u5df2\u4ed8\u6b3e";break;case 4:b="\u5df2\u9000\u6b3e";break;case 5:b="\u4ed8\u6b3e\u5931\u8d25";break;case 6:b="\u5df2\u5b8c\u6210";break;case 7:b="\u5df2\u56de\u6536";break;case 8:b="\u9000\u6b3e\u4e2d"}return b}),juicer.register("makeType",function(a){var b="\u7ebf\u4e0b\u95e8\u8bca";switch(a){case 1:b="\u7ebf\u4e0b\u95e8\u8bca";break;case 2:b="\u7ebf\u4e0a\u95ee\u8bca";break;case 3:b="\u9884\u7ea6\u4f53\u68c0"}return b}),juicer.register("makeTitle",function(a){var b="";switch(a){case 1:b="\u4e3b\u4efb\u533b\u5e08";break;case 2:b="\u526f\u4e3b\u4efb\u533b\u5e08";break;case 3:b="\u4e3b\u6cbb\u533b\u5e08";break;case 4:b="\u4f4f\u9662\u533b\u5e08"}return b}),juicer.register("makeFuckTime",function(a){var b,a=new Date(a);switch(a.getDay()){case 0:b="\u5468\u65e5";break;case 1:b="\u5468\u4e00";break;case 2:b="\u5468\u4e8c";break;case 3:b="\u5468\u4e09";break;case 4:b="\u5468\u56db";break;case 5:b="\u5468\u4e94";break;case 6:b="\u5468\u516d"}var c={y:a.getFullYear(),m:a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,d:a.getDate(),w:b},d=c.y+"/"+c.m+"/"+c.d;return d}),juicer.register("makeDep",function(b){for(var c="",d="",e=0;e<a.data.depList.length;e++)b==a.data.depList[e].data.id&&(d=a.data.depList[e].data.name);return c}),juicer.register("makeFuckTimeFuck",function(a){var b,a=new Date(parseInt(a));switch(a.getDay()){case 0:b="\u5468\u65e5";break;case 1:b="\u5468\u4e00";break;case 2:b="\u5468\u4e8c";break;case 3:b="\u5468\u4e09";break;case 4:b="\u5468\u56db";break;case 5:b="\u5468\u4e94";break;case 6:b="\u5468\u516d"}var c={y:a.getFullYear(),m:a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,d:a.getDate()<10?"0"+a.getDate():a.getDate(),w:b,h:a.getHours()<10?"0"+a.getHours():a.getHours(),mm:a.getMinutes()+1<10?"0"+(a.getMinutes()+1):a.getMinutes()+1},d=c.y+"\u5e74"+c.m+"\u6708"+c.d+"\u65e5 "+c.h+":"+c.mm;return d}),juicer.register("makeStatusDisplay",function(b){return b==a.data.orderStatus?"selected":""}),juicer.register("makeFilterDisplay",function(){var b,c=a.data.orderType;switch(c){case"-1":b="\u7b5b\u9009";break;case"1":b="\u7ebf\u4e0b\u95e8\u8bca";break;case"2":b="\u7ebf\u4e0a\u95ee\u8bca";break;case"3":b="\u9884\u7ea6\u4f53\u9a8c"}return b})},bindEvent:function(){var c=this;c.dom.filter.on("click",function(){c.dom.filterbox.toggle(),c.dom.overlay.toggleClass("fadeIn")}),c.dom.overlay.on("click",function(){c.dom.overlay.toggleClass("fadeIn"),c.dom.filterbox.toggle()}),c.dom.bannerItems.on("click",function(){var a=b(this).hasClass(".selected");a||b(this).addClass("selected").siblings(".item").removeClass("selected")}),b(".banner li").on("click",function(){var d=b(this).attr("data-id");a.location.replace("../../pages/orderlist/index.html?orderStatus="+d+"&orderType="+c.data.orderType)}),b(".filterbox li").on("click",function(){var d=b(this).attr("data-id");a.location.replace("../../pages/orderlist/index.html?orderStatus="+c.data.orderStatus+"&orderType="+d)}),b(".topayBtn").on("click",function(){var a=b(this).attr("data-oid"),d=b(this).attr("data-price");c.payFor(a,d)}),b(".tocanBtn").on("click",function(){var a=b(this).attr("data-oid"),c=b(this).attr("data-orderType"),d={userid:localStorage.getItem("userId"),orderid:a,orderType:c};Wlib.SendRequestNew("treatOperate","cancelOrder",d,function(a){0==a.errorCode?location.reload():Wlib.tips(a.message)})})},payFor:function(a,b){var c={userid:localStorage.getItem("userId"),orderid:a,amount:b,channel:"weixin",clientIp:"127.0.0.1",openid:localStorage.getItem("openid")};Wlib.SendRequestNew("pay","payOrder",c,function(a){wx.config({debug:!1,appId:a.value.result.appId,timestamp:a.value.result.timeStamp,nonceStr:a.value.result.nonceStr,signature:a.value.paySign,jsApiList:["chooseWXPay"]}),wx.ready(function(){wx.chooseWXPay({timestamp:a.value.result.timeStamp,nonceStr:a.value.result.nonceStr,"package":a.value.result["package"],signType:"MD5",paySign:a.value.result.paySign,success:function(a){alert(JSON.stringify(a)),"chooseWXPay:ok"==a.errMsg?location.reload():(alert("\u652f\u4ed8\u5931\u8d25"),location.reload())},cancel:function(a){location.reload()}})})})}};new c}(window,$);